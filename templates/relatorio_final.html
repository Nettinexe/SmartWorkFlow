{% extends 'base.html' %}
{% load custom_filters %} {% block title %}Relatório: {{ relatorio.aluno.nome_completo }}{% endblock %}

{% block content %}
<div class="container bg-white shadow p-5 my-4" style="max-width: 900px; min-height: 100vh;">
    
    <div class="text-center border-bottom pb-4 mb-4">
        <h1 class="fw-bold text-uppercase">Escola Municipal Ataualpa Duque</h1>
        <p class="text-muted mb-0">Relatório de Desenvolvimento Individual do Aluno</p>
    </div>

    <div class="row mb-5 bg-light p-3 rounded">
        <div class="col-md-6">
            <strong>Aluno(a):</strong> {{ relatorio.aluno.nome_completo }}<br>
            <strong>Turma:</strong> {{ relatorio.aluno.turma.nome }}
        </div>
        <div class="col-md-6 text-end">
            <strong>Trimestre:</strong> {{ relatorio.trimestre }}º<br>
            <strong>Ano:</strong> {{ relatorio.ano }}
        </div>
    </div>

    <h4 class="text-primary fw-bold border-bottom pb-2 mb-4">Desempenho por Competência</h4>

    {% for avaliacao in avaliacoes %}
    <div class="mb-5">
        <h5 class="fw-bold text-dark">
            <span class="badge bg-secondary me-2">{{ avaliacao.competencia.componente }}</span>
            {{ avaliacao.competencia.habilidade }}
        </h5>
        
        <div class="ps-3 border-start border-4 border-primary ms-1 mt-2">
            <p class="mb-1">
                <strong>Nível Alcançado:</strong> 
                <span class="badge bg-primary">{{ avaliacao.get_nivel_display }}</span>
            </p>
            <p class="text-muted fst-italic">"{{ avaliacao.observacao_especifica }}"</p>
        </div>

        {% with sugestoes=sugestoes_map|get_item:avaliacao.id %}
            {% if sugestoes %}
            <div class="mt-3 p-3 bg-warning bg-opacity-10 rounded border border-warning">
                <h6 class="fw-bold text-warning text-uppercase small">
                    <i class="bi bi-stars"></i> Sugestões de Atividade para Casa:
                </h6>
                <ul class="mb-0 ps-3">
                    {% for sug in sugestoes %}
                    <li class="mb-2">
                        <strong>{{ sug.titulo }}:</strong> {{ sug.descricao }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        {% endwith %}
    </div>
    <hr class="text-muted opacity-25">
    {% empty %}
    <p class="text-center text-muted">Nenhuma avaliação registrada ainda.</p>
    {% endfor %}

    <div class="text-center mt-5 pt-5 text-muted small">
        <p>___________________________________<br>Assinatura da Coordenação</p>
    </div>
</div>
{% endblock %}